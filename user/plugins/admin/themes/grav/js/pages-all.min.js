$(function(){var j=window||{};j=j.GravJS=j.GravJS||{};if($(".tab-body .form-label label").text().indexOf("Tile Content")>=0){$("#tab-body-4 .form-label.size-1-4").css("display","none")}j.currentValues=getState();var d;var h=$("input.page-filter"),c=h.data("template-types"),a=h.data("template-access-levels"),o=[{flag:"Modular",key:"Modular",cat:"mode"},{flag:"Visible",key:"Visible",cat:"mode"},{flag:"Routable",key:"Routable",cat:"mode"},{flag:"Published",key:"Published",cat:"mode"},{flag:"Non-Modular",key:"NonModular",cat:"mode"},{flag:"Non-Visible",key:"NonVisible",cat:"mode"},{flag:"Non-Routable",key:"NonRoutable",cat:"mode"},{flag:"Non-Published",key:"NonPublished",cat:"mode"},];if(h&&c){jQuery.each(c,function(p,e){o.push({flag:e,key:p,cat:"type"})});jQuery.each(a,function(p,e){o.push({flag:e,key:e,cat:"access"})});h.selectize({maxItems:null,valueField:"key",labelField:"flag",searchField:["flag","key"],options:o,optgroups:[{id:"mode",name:translations.PLUGIN_ADMIN.PAGE_MODES},{id:"type",name:translations.PLUGIN_ADMIN.PAGE_TYPES},{id:"access",name:translations.PLUGIN_ADMIN.ACCESS_LEVELS},],optgroupField:"cat",optgroupLabelField:"name",optgroupValueField:"id",optgroupOrder:["mode","type","access"],plugins:["optgroup_columns"]})}try{sessionStorage.setItem("sessionStorage",1);sessionStorage.removeItem("sessionStorage")}catch(i){Storage.prototype._setItem=Storage.prototype.setItem;Storage.prototype.setItem=function(){}}var b=$('[data-toggle="children"]'),g=sessionStorage.getItem("grav:admin:pages"),f=function(e){b.each(function(t,s){var u=$(s).find(".page-icon"),p=u.hasClass("children-open"),r=$(s).closest("[data-nav-id]").data("nav-id"),q=$(s).closest("li.page-item").find("ul:first");if(p){q.hide();if(e){delete g[r]}u.removeClass("children-open").addClass("children-closed")}if(e){sessionStorage.setItem("grav:admin:pages",JSON.stringify(g))}})},n=function(e){b.each(function(t,s){var u=$(s).find(".page-icon"),p=u.hasClass("children-open"),r=$(s).closest("[data-nav-id]").data("nav-id"),q=$(s).closest("li.page-item").find("ul:first");if(!p){q.show();if(e){g[r]=1}u.removeClass("children-closed").addClass("children-open")}if(e){sessionStorage.setItem("grav:admin:pages",JSON.stringify(g))}})},k=function(){f();for(var r in g){var q=$('[data-nav-id="'+r+'"]'),s=q.find(".page-icon").first(),e=s.hasClass("children-open"),p=q.closest("li.page-item").find("ul:first");p.show();s.removeClass("children-closed").addClass("children-open")}};if(!g){sessionStorage.setItem("grav:admin:pages",(g="{}"))}g=JSON.parse(g);k();var m=function(){var p="task"+GravAdmin.config.param_sep;$('input[name="page-search"]').focus();var e=$('input[name="page-filter"]').val(),q=$('input[name="page-search"]').val();if(!e.length&&!q.length){GravAjax.jqxhr.abort();return l([],true)}GravAjax({dataType:"json",method:"POST",url:GravAdmin.config.base_url_relative+"/pages-filter.json/"+p+"filterPages",data:{flags:e,query:q,"admin-nonce":GravAdmin.config.admin_nonce},toastErrors:true,success:function(r,s){l(r.results)}})};var l=function(e,q){var p=$("[data-nav-id]");p.removeClass("search-match");if(q){p.addClass("search-match");k()}else{e.forEach(function(t){var s=p.filter('[data-nav-id="'+t+'"]'),r=s.parents("[data-nav-id]");s.addClass("search-match");s.find("[data-nav-id]").addClass("search-match");r.addClass("search-match");r.find('[data-toggle="children"]').each(function(v,x){var y=$(this).find(".page-icon"),u=y.hasClass("children-open"),w=$(this).closest("li.page-item").find("ul:first");if(!u){w.show();y.removeClass("children-closed").addClass("children-open")}})})}p.each(function(r,s){if($(s).hasClass("search-match")){$(s).show()}else{$(s).hide()}})};$('input[name="page-search"]').on("input",m);$('input[name="page-filter"]').on("change",m);$('input[name="folder"]').on("input",function(){$(this).data("user-custom-folder",true);if(!$(this).val()){$(this).data("user-custom-folder",false)}});$('input[name="title"]').on("input",function(p){if(!$('input[name="folder"]').data("user-custom-folder")){folder=$.slugify($(this).val());$('input[name="folder"]').val(folder)}});$("#slug-target").slugify("#slug-source");$('input[name="folder"]').on("input",function(q){var r=this.selectionStart,p=this.selectionEnd;value=$(this).val().toLowerCase().replace(/\s/g,"-").replace(/[^a-z0-9_\-]/g,"");$(this).val(value);this.setSelectionRange(r,p)});b.on("click",function(){var r=$(this).find(".page-icon"),e=r.hasClass("children-open"),q=$(this).closest("[data-nav-id]").data("nav-id"),p=$(this).closest("li.page-item").find("ul:first");if(e){p.hide();delete g[q];r.removeClass("children-open").addClass("children-closed")}else{p.show();g[q]=true;r.removeClass("children-closed").addClass("children-open")}sessionStorage.setItem("grav:admin:pages",JSON.stringify(g))});$("[data-page-toggleall]").on("click",function(){var e=$(this).data("page-toggleall");if(e=="collapse"){f(true)}else{n(true)}});$("#admin-main button").on("click",function(){$(window).off("beforeunload")});$("[data-remodal-id] form").on("submit",function(){$(window).off("beforeunload")});$("#admin-mode-toggle input[name=mode-switch]").on("change",function(u){var t=$(this).val(),r=$(this).data("leave-url");if(j.currentValues==getState()){setTimeout(function(){window.location.href=r},200);return true}u.preventDefault();var p=$.remodal.lookup[$("[data-remodal-id=changes]").data("remodal")],q=$("[data-remodal-id=changes] a.button"),s;q.on("click",function(v){v.preventDefault();s=$(this).data("leave-action");q.off("click");p.close();if(s=="continue"){$(window).off("beforeunload");window.location.href=$("#admin-mode-toggle input[name=mode-switch]:checked").data("leave-url")}else{$("input[name=mode-switch][checked]").prop("checked",true)}});p.open()});$('a[href]:not([href^="#"])').on("click",function(s){if(j.currentValues!=getState()){s.preventDefault();d=$(this).attr("href");var p=$.remodal.lookup[$("[data-remodal-id=changes]").data("remodal")],q=$("[data-remodal-id=changes] a.button"),r;q.on("click",function(t){t.preventDefault();r=$(this).data("leave-action");q.off("click");p.close();if(r=="continue"){$(window).off("beforeunload");window.location.href=d}});p.open()}});$('[data-remodal-target="delete"]').on("click",function(){var e=$("[data-remodal-id=delete] a.button");e.data("delete-action",$(this).data("delete-url"))});$("[data-delete-action]").on("click",function(){var e=$.remodal.lookup[$("[data-remodal-id=delete]").data("remodal")],p=$(this).data("delete-action");window.location.href=p;e.close()});$(window).on("beforeunload",function(){if(j.currentValues!=getState()){return"You have made changes on this page that you have not yet confirmed. If you navigate away from this page you will lose your unsaved changes"}});$("[data-page-move] button").on("click",function(){var e=jQuery("form#blueprints").first().find('select[name="route"]'),q=$("[data-page-move] select").val();if(e.length&&e.val()!==q){var p=e.data("selectize");e.val(q);if(p){p.setValue(q)}}})});