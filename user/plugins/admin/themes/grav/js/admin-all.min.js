var getState=function(){var b=[],a=["page-filter","page-search"];$("input, select, textarea").each(function(d,e){var c=$(e).prop("name"),f=$(e).val();if(c&&!~a.indexOf(c)){b.push(c+"|"+f)}});return b.toString()};var bytesToSize=function(a){var c=["Bytes","KB","MB","GB","TB"];if(a==0){return"0 Byte"}var b=parseInt(Math.floor(Math.log(a)/Math.log(1024)));return Math.round(a/Math.pow(1024,b),2)+" "+c[b]};var isFirefox=navigator.userAgent.toLowerCase().indexOf("firefox")>-1;var keepAlive=function keepAlive(){$.post(GravAdmin.config.base_url_relative+"/task"+GravAdmin.config.param_sep+"keepAlive",{"admin-nonce":GravAdmin.config.admin_nonce})};$(function(){jQuery.substitute=function(i,h){return i.replace(/\{(.+?)\}/g,function(k,j){return j in h?h[j]:k})};toastr.options={positionClass:"toast-top-right"};var c=$(".updates-chart"),g;if(c.length){var e={series:[100,0]};var b={donut:true,donutWidth:10,startAngle:0,total:100,showLabel:false,height:150,chartPadding:!isFirefox?5:10};g=Chartist.Pie(".updates-chart .ct-chart",e,b);g.on("draw",function(h){if(h.index){return}c.find(".numeric span").text(Math.round(h.value)+"%");var i=translations.PLUGIN_ADMIN.UPDATES_AVAILABLE;if(h.value==100){i=translations.PLUGIN_ADMIN.FULLY_UPDATED}$(".js__updates-available-description").html(i);$(".updates-chart .hidden").removeClass("hidden")})}$("[data-clear-cache]").on("click",function(i){$(this).attr("disabled","disabled").find("> .fa").removeClass("fa-trash").addClass("fa-refresh fa-spin");var h=$(this).data("clearCache");GravAjax({dataType:"json",url:h,toastErrors:true,success:function(j,k){toastr.success(j.message)}}).always(function(){$("[data-clear-cache]").removeAttr("disabled").find("> .fa").removeClass("fa-refresh fa-spin").addClass("fa-trash")})});$(".gpm-name, .gpm-actions").on("click",function(i){var h=$(i.target);if(h.prop("tagName")=="A"||h.parent("a").length){return true}var j=$(this).siblings(".gpm-details").find(".table-wrapper");j.slideToggle({duration:350,complete:function(){var k=j.is(":visible");j.closest("tr").find(".gpm-details-expand i").removeClass("fa-chevron-"+(k?"down":"up")).addClass("fa-chevron-"+(k?"up":"down"))}})});$(document).on("click","[data-maintenance-update]",function(j){$(this).attr("disabled","disabled").find("> .fa").removeClass("fa-cloud-download").addClass("fa-refresh fa-spin");var i=$(this).data("maintenanceUpdate");var h="task"+GravAdmin.config.param_sep;GravAjax({dataType:"json",url:i,toastErrors:true,success:function(k,l){if(i.indexOf(h+"updategrav")!==-1){if(k.status=="success"){$("[data-gpm-grav]").remove();toastr.success(k.message+window.grav_available_version);$("#footer .grav-version").html(window.grav_available_version)}else{toastr.success(k.message)}}else{toastr.success(k.message)}}}).always(function(){f();$("[data-maintenance-update]").removeAttr("disabled").find("> .fa").removeClass("fa-refresh fa-spin").addClass("fa-cloud-download")})});$("[data-ajax]").on("click",function(m){var j=$(this),k=j.find("> .fa"),i=j.data("ajax");var l=[],h=["fa-lg","fa-2x","fa-3x","fa-4x","fa-5x","fa-fw","fa-ul","fa-li","fa-border","fa-rotate-90","fa-rotate-180","fa-rotate-270","fa-flip-horizontal","fa-flip-vertical"];j.attr("disabled","disabled");$.each(k.attr("class").split(/\s+/),function(n,o){if(o.indexOf("fa-")===0&&$.inArray(o,h)===-1){l.push(o);k.removeClass(o)}});k.addClass("fa-refresh fa-spin");GravAjax({dataType:"json",url:i,toastErrors:true,success:function(n,o){var p="task"+GravAdmin.config.param_sep;var s={};if(n.toastr){for(var r in n.toastr){if(n.toastr.hasOwnProperty(r)){s[r]=toastr.options[r];toastr.options[r]=n.toastr[r]}}}toastr.success(n.message||translations.PLUGIN_ADMIN.TASK_COMPLETED);for(var r in s){if(s.hasOwnProperty(r)){toastr.options[r]=s[r]}}if(i.indexOf(p+"backup")!==-1){$(".backups-chart .numeric").html("0 <em>"+translations.PLUGIN_ADMIN.DAYS+"</em>");var t={series:[0,100]};var q={donut:true,donutWidth:10,startAngle:0,total:100,showLabel:false,height:150};Chartist.Pie(".backups-chart .ct-chart",t,q)}}}).always(function(){j.removeAttr("disabled");k.removeClass("fa-refresh fa-spin").addClass(l.join(" "))})});$("[data-gpm-checkupdates]").on("click",function(){var h=$(this);h.find("i").addClass("fa-spin");f({flush:true,callback:function(i){var l=i.status=="success"?i.payload:false;h.find("i").removeClass("fa-spin");if(l){if(!l.grav.isUpdatable&&!l.resources.total){toastr.success(translations.PLUGIN_ADMIN.EVERYTHING_UP_TO_DATE)}else{var j=l.grav.isUpdatable?"Grav v"+l.grav.available:"";var k=l.resources.total?l.resources.total+" "+translations.PLUGIN_ADMIN.UPDATES_ARE_AVAILABLE:"";if(!k){j+=" "+translations.PLUGIN_ADMIN.IS_AVAILABLE_FOR_UPDATE}toastr.info(j+(j&&k?" "+translations.PLUGIN_ADMIN.AND+" ":"")+k)}}}})});var f=function(h){h=h||{};var i={task:"GPM",action:"getUpdates"};if(h.flush){i.flush=true}GravAjax({dataType:"JSON",url:window.location.href,method:"POST",data:i,toastErrors:true,success:function(k){if(!k){return}var F=k.payload.grav,m=k.payload.installed,A=k.payload.resources,B="task"+GravAdmin.config.param_sep;if(F.isUpdatable){var D='<i class="fa fa-bullhorn"></i> ';x="Grav <b>v{available}</b> "+translations.PLUGIN_ADMIN.IS_NOW_AVAILABLE+'! <span class="less">('+translations.PLUGIN_ADMIN.CURRENT+": v{version})</span> ",j='<button data-maintenance-update="'+GravAdmin.config.base_url_relative+"/update.json/"+B+"updategrav/admin-nonce"+GravAdmin.config.param_sep+GravAdmin.config.admin_nonce+'" class="button button-small secondary" id="grav-update-button">'+translations.PLUGIN_ADMIN.UPDATE_GRAV_NOW+"</button>";if(F.isSymlink){j='<span class="hint--left" style="float: right;" data-hint="'+translations.PLUGIN_ADMIN.GRAV_SYMBOLICALLY_LINKED+'"><i class="fa fa-fw fa-link"></i></span>'}x=jQuery.substitute(x,{available:F.available,version:F.version});$("[data-gpm-grav]").addClass("grav").html("<p>"+D+x+j+"</p>");window.grav_available_version=F.available}$("#grav-update-button").on("click",function(){$(this).html(translations.PLUGIN_ADMIN.UPDATING_PLEASE_WAIT+" "+bytesToSize(F.assets["grav-update"].size)+"..")});if($(".updates-chart").length){var y=(A.total+(F.isUpdatable?1:0))*100/(m+(F.isUpdatable?1:0)),z=100-y;g.update({series:[z,y]});if(A.total){$("#updates [data-maintenance-update]").fadeIn()}}if(!A.total){$("#updates [data-maintenance-update]").fadeOut();$(".badges.with-updates").removeClass("with-updates").find(".badge.updates").remove()}else{var p,D='<i class="fa fa-bullhorn"></i>',x="{updates} "+translations.PLUGIN_ADMIN.OF_YOUR+" {type} "+translations.PLUGIN_ADMIN.HAVE_AN_UPDATE_AVAILABLE,j='<a href="{location}/'+B+"update/admin-nonce"+GravAdmin.config.param_sep+GravAdmin.config.admin_nonce+'" class="button button-small secondary">'+translations.PLUGIN_ADMIN.UPDATE+" {Type}</a>",v=$(".grav-update.plugins"),w=$(".grav-update.themes"),t={plugins:$('#admin-menu a[href$="/plugins"]'),themes:$('#admin-menu a[href$="/themes"]')};if(t.plugins.length||t.themes.length){var p,u;if(t.plugins.length&&(p=Object.keys(A.plugins).length)){u=t.plugins.find(".badges");u.addClass("with-updates");u.find(".badge.updates").text(p)}if(t.themes.length&&(p=Object.keys(A.themes).length)){u=t.themes.find(".badges");u.addClass("with-updates");u.find(".badge.updates").text(p)}}if(v[0]&&(p=Object.keys(A.plugins).length)){x=jQuery.substitute(x,{updates:p,type:"plugins"});j=jQuery.substitute(j,{Type:"All Plugins",location:GravAdmin.config.base_url_relative+"/plugins"});v.html("<p>"+D+x+j+"</p>");var o,q;$.each(A.plugins,function(G,H){o=$('[data-gpm-plugin="'+G+'"] .gpm-name');q=o.find("a");if(!o.find(".badge.update").length){o.append('<a class="plugin-update-button" href="'+q.attr("href")+'"><span class="badge update">'+translations.PLUGIN_ADMIN.UPDATE_AVAILABLE+"!</span></a>")}})}if(w[0]&&(p=Object.keys(A.themes).length)){x=jQuery.substitute(x,{updates:p,type:"themes"});j=jQuery.substitute(j,{Type:"All Themes",location:GravAdmin.config.base_url_relative+"/themes"});w.html("<p>"+D+x+j+"</p>");var E,q;$.each(A.themes,function(G,H){E=$('[data-gpm-theme="'+G+'"]');q=E.find(".gpm-name a");E.append('<div class="gpm-ribbon"><a href="'+q.attr("href")+'">'+translations.PLUGIN_ADMIN.UPDATE.toUpperCase()+"</a></div>")})}var n="plugin",C=$(".grav-update.plugin")[0];if(!C){C=$(".grav-update.theme")[0];n="theme"}if(C){var s=$("[data-gpm-"+n+"]").data("gpm-"+n),r=n.charAt(0).toUpperCase()+n.substring(1),l=A[n+"s"][s];if(l){x="<strong>v{available}</strong> "+translations.PLUGIN_ADMIN.OF_THIS+" "+n+" "+translations.PLUGIN_ADMIN.IS_NOW_AVAILABLE+"!";x=jQuery.substitute(x,{available:l.available});j=jQuery.substitute(j,{Type:r,location:GravAdmin.config.base_url_relative+"/"+n+"s/"+s});$(C).html("<p>"+D+x+j+"</p>")}}}if(h.callback&&typeof h.callback=="function"){h.callback(k)}}}).always(function(){$("[data-gpm-checkupdates]").find("i").removeClass("fa-spin")})};if(GravAdmin.config.enable_auto_updates_check==="1"){f()}function a(l){var i=l.find("[data-collection-holder]"),k=l.find('[data-action="add"]'),j=i.data("collection-holder"),h=0;i.find("[data-collection-item]").each(function(){var o=$(this),m=o.attr("data-collection-key");if(h!=m){var n=new RegExp("^"+j.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")+"[.[]"+m);o.attr("data-collection-item",o.attr("data-collection-item").replace(n,j+"."+h));o.attr("data-collection-key",h);o.find("[name]").each(function(){$(this).attr("name",$(this).attr("name").replace(n,j+"["+h))})}h++});k.data("key-index",h)}$('[data-type="collection"]').each(function(){var l=$(this),j=l.find("[data-collection-holder]"),i=l.find("[data-collection-config]"),h=i.data("collection-array"),k=l.find('[data-collection-template="new"]').html();new Sortable(j[0],{filter:".form-input-wrapper, .form-markdown-wrapper",onUpdate:function(){if(h){a(l)}}});l.on("click",'[data-action="delete"]',function(m){$(this).closest("[data-collection-item]").remove();if(h){a(l)}});l.find('[data-action="add"]').on("click",function(r){var p=$(this),o=p.data("key-index"),n=$(k);n.attr("data-collection-item",n.attr("data-collection-item").replace("*",o));n.attr("data-collection-key",o);var m=function m(s){n.find("["+s+"]").each(function(){$(this).attr(s,$(this).attr(s).replace("*",o))})};m("name");m("data-grav-field-name");m("id");m("for");j.append(n);p.data("key-index",++o);var q=n.find("[name]").filter("textarea");if(q.length&&q.data("grav-mdeditor")&&typeof MDEditors!=="undefined"){MDEditors.add(q)}})});jQuery(document).on("input propertychange click",".form-data textarea, .form-data input, .form-data label, .form-data .selectize-input",function(){var h=this;var i=$(h).parents(".form-field").find('.toggleable input[type="checkbox"]');if(i.length>0){i.prop("checked",true)}$(this).css("opacity",1);$(this).parents(".form-data").css("opacity",1);i.css("opacity",1);i.prop("checked",true);i.prop("value",1);i.siblings("label").css("opacity",1);i.parent().siblings("label").css("opacity",1)});jQuery(document).on("click","label.toggleable",function(){var i=$(this).siblings(".checkboxes.toggleable").find("input");var h=!i.is(":checked");i.prop("checked",h);i.prop("value",h?1:0);$(this).css("opacity",h?1:0.7);i.siblings("label").css("opacity",h?1:0.7);$(this).parents(".form-label").siblings(".form-data").css("opacity",h?1:0.7)});$(document).on("mousedown",'[data-remodal-target="theme-switch-warn"]',function(i){var h=$(i.target).closest("[data-gpm-theme]").find(".gpm-name a").text(),j=$(".remodal.theme-switcher");j.find("strong").text(h);j.find(".button.continue").attr("href",$(i.target).attr("href"))});if($(document).find('[data-grav-keepalive="true"]').length>0){setInterval(function(){keepAlive()},(GravAdmin.config.admin_timeout/2)*1000)}var d=$('[name="task"][value="save"]').filter(function(h,i){return !($(i).parents(".remodal-overlay").length)});if(d.length){$(window).on("keydown",function(i){var h=String.fromCharCode(i.which).toLowerCase();if((i.ctrlKey||i.metaKey)&&h=="s"){i.preventDefault();d.click()}})}});